# ARK Production Environment Configuration
# Do NOT commit this file to version control
# Use: source .env.production before starting services

# === CORE SETTINGS ===
ARK_ENV=prod
ARK_LOG_LEVEL=INFO
ARK_STATE_DB=/var/lib/ark/ark_state.db

# === DATABASE SETTINGS ===
# Enable WAL mode for better concurrency
ARK_DB_WAL_ENABLED=true
ARK_DB_CHECKPOINT_INTERVAL=300  # 5 minutes

# === REDIS SETTINGS ===
REDIS_URL=redis://localhost:6379/0
REDIS_STREAM_MAXLEN=10000
REDIS_POOL_SIZE=20
REDIS_TIMEOUT=5

# === API SETTINGS ===
# Internal LB only - DO NOT expose externally
API_HOST=127.0.0.1
API_PORT=8000
API_WORKERS=1  # One per agent process
API_THREADS=4  # Cap to CPU cores

# === MONITORING ===
METRICS_SERVER_ENABLED=true
METRICS_HOST=0.0.0.0
METRICS_PORT=9090
METRICS_EXPORT_INTERVAL=10  # seconds
METRICS_RETENTION_SECONDS=3600  # 1 hour

# SLO Targets
SLO_AVAILABILITY_TARGET=0.995  # 99.5%
SLO_P95_LATENCY_MS=400
SLO_HRM_EVAL_LATENCY_MS=120
SLO_WINDOW_SECONDS=300  # 5 minute rolling window

# Trace ID Configuration
TRACE_ID_ENABLED=true
TRACE_ID_PROPAGATION=true
TRACE_CONTINUITY_VALIDATION=true

# === SECURITY ===
# Session secret - REPLACE with secure random value
SESSION_SECRET=REPLACE_WITH_SECURE_RANDOM_VALUE_MIN_32_CHARS

# JWT secret - REPLACE with secure random value  
JWT_SECRET=REPLACE_WITH_SECURE_RANDOM_VALUE_MIN_32_CHARS

# CORS - Internal only
CORS_ORIGINS=http://localhost:3000,http://internal-lb

# === AGENT SETTINGS ===
AGENT_CONCURRENCY=1  # One worker per agent
AGENT_THREAD_POOL=4  # Cap to CPU cores
AGENT_HEARTBEAT_INTERVAL=5  # seconds

# === RATE LIMITING ===
# Kenny execution rate limiter
KENNY_MAX_ACTIONS_PER_MINUTE=60
KENNY_BURST_LIMIT=10

# Backpressure thresholds
REDIS_QUEUE_MAX_DEPTH=1000
REDIS_BACKPRESSURE_THRESHOLD=800

# === WATCHDOG SETTINGS ===
WATCHDOG_ENABLED=true
WATCHDOG_QUARANTINE_ENABLED=true
WATCHDOG_AUTO_ISOLATION=true
WATCHDOG_EMERGENCY_HALT_ENABLED=true

# Thresholds
WATCHDOG_MAX_LATENCY_MS=5000
WATCHDOG_MAX_FAILURE_RATE=0.20
WATCHDOG_MAX_CONSECUTIVE_FAILURES=5
WATCHDOG_MAX_QUEUE_DEPTH=1000
WATCHDOG_MAX_GRAVEYARD_VIOLATIONS_PER_MIN=10

# === GRAVEYARD SETTINGS ===
GRAVEYARD_RULESET_VERSION=1.0.0
GRAVEYARD_STRICT_MODE=true
GRAVEYARD_HARD_DENY_ON_BREACH=true

# === LOGGING ===
LOG_RETENTION_DAYS=30
LOG_FORMAT=json  # Structured logging
LOG_TRACE_ENABLED=true  # Enable trace_id tracking

# === BACKUP ===
BACKUP_ENABLED=true
BACKUP_INTERVAL=3600  # 1 hour
BACKUP_RETENTION=7  # days
BACKUP_DIR=/var/backups/ark

# === HEALTH CHECKS ===
HEALTH_CHECK_INTERVAL=10  # seconds
READINESS_CHECK_TIMEOUT=2  # seconds

# === BROKER/API KEYS (REPLACE WITH ACTUAL VALUES) ===
# Paper trading or live - NEVER commit real keys
ALPACA_API_KEY=REPLACE_WITH_ACTUAL_KEY
ALPACA_SECRET_KEY=REPLACE_WITH_ACTUAL_SECRET
ALPACA_BASE_URL=https://paper-api.alpaca.markets  # Use paper for canary

# Market data
ALPHA_VANTAGE_API_KEY=REPLACE_WITH_ACTUAL_KEY

# === DEPLOYMENT METADATA ===
DEPLOYMENT_VERSION=1.0.0
DEPLOYMENT_TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)
DEPLOYMENT_ENV=production
CANARY_PERCENTAGE=10  # Start with 10% traffic
