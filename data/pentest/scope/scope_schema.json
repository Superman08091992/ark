{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ark-agi.com/schemas/pentest-scope-v1.json",
  "title": "ARK Penetration Testing Scope Definition",
  "description": "Machine-readable scope definition for authorized security testing",
  "type": "object",
  "required": [
    "authorization_id",
    "version",
    "effective_date",
    "expiration_date",
    "scope_hash",
    "in_scope",
    "out_of_scope",
    "time_windows",
    "allowed_methods"
  ],
  "properties": {
    "authorization_id": {
      "type": "string",
      "description": "Unique authorization identifier (e.g., AUTH-2025-001)",
      "pattern": "^AUTH-[0-9]{4}-[0-9]{3}$"
    },
    "version": {
      "type": "string",
      "description": "Scope document version (semantic versioning)",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "effective_date": {
      "type": "string",
      "description": "ISO 8601 timestamp when scope becomes active",
      "format": "date-time"
    },
    "expiration_date": {
      "type": "string",
      "description": "ISO 8601 timestamp when scope expires",
      "format": "date-time"
    },
    "scope_hash": {
      "type": "string",
      "description": "SHA-256 hash of in_scope object for integrity verification",
      "pattern": "^[a-f0-9]{64}$"
    },
    "authorized_by": {
      "type": "object",
      "required": ["name", "title", "email"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Full name of authorized signatory"
        },
        "title": {
          "type": "string",
          "description": "Job title of authorized signatory"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Email address of authorized signatory"
        },
        "phone": {
          "type": "string",
          "description": "Phone number for emergency contact"
        }
      }
    },
    "in_scope": {
      "type": "object",
      "description": "Assets explicitly authorized for testing",
      "properties": {
        "ip_addresses": {
          "type": "array",
          "description": "Individual IP addresses or CIDR ranges",
          "items": {
            "type": "string",
            "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}(\\/[0-9]{1,2})?$"
          }
        },
        "ip_ranges": {
          "type": "array",
          "description": "IP address ranges (start-end format)",
          "items": {
            "type": "object",
            "required": ["start", "end"],
            "properties": {
              "start": {
                "type": "string",
                "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}$"
              },
              "end": {
                "type": "string",
                "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}$"
              },
              "description": {
                "type": "string"
              }
            }
          }
        },
        "hostnames": {
          "type": "array",
          "description": "Fully qualified domain names",
          "items": {
            "type": "string",
            "pattern": "^([a-zA-Z0-9-_]+\\.)*[a-zA-Z0-9-_]+\\.[a-zA-Z]{2,}$"
          }
        },
        "wildcard_domains": {
          "type": "array",
          "description": "Wildcard domain patterns (e.g., *.staging.example.com)",
          "items": {
            "type": "string",
            "pattern": "^\\*\\.([a-zA-Z0-9-_]+\\.)*[a-zA-Z0-9-_]+\\.[a-zA-Z]{2,}$"
          }
        },
        "urls": {
          "type": "array",
          "description": "Specific URLs or URL patterns",
          "items": {
            "type": "object",
            "required": ["url"],
            "properties": {
              "url": {
                "type": "string",
                "format": "uri"
              },
              "methods": {
                "type": "array",
                "description": "Allowed HTTP methods",
                "items": {
                  "type": "string",
                  "enum": ["GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS"]
                }
              },
              "description": {
                "type": "string"
              }
            }
          }
        },
        "repositories": {
          "type": "array",
          "description": "Source code repositories",
          "items": {
            "type": "object",
            "required": ["url"],
            "properties": {
              "url": {
                "type": "string",
                "description": "Repository URL (e.g., github.com/org/repo)"
              },
              "branch": {
                "type": "string",
                "description": "Specific branch to test"
              },
              "commit_range": {
                "type": "string",
                "description": "Commit range (e.g., abc123..def456)"
              }
            }
          }
        },
        "containers": {
          "type": "array",
          "description": "Container images",
          "items": {
            "type": "object",
            "required": ["image"],
            "properties": {
              "image": {
                "type": "string",
                "description": "Container image reference"
              },
              "registry": {
                "type": "string",
                "description": "Container registry URL"
              },
              "tag": {
                "type": "string",
                "description": "Image tag or digest"
              }
            }
          }
        },
        "cloud_resources": {
          "type": "array",
          "description": "Cloud provider resources",
          "items": {
            "type": "object",
            "required": ["provider", "resource_id"],
            "properties": {
              "provider": {
                "type": "string",
                "enum": ["aws", "azure", "gcp", "other"]
              },
              "resource_id": {
                "type": "string",
                "description": "Resource identifier (account ID, subscription ID, etc.)"
              },
              "region": {
                "type": "string",
                "description": "Cloud region"
              },
              "resource_tags": {
                "type": "object",
                "description": "Key-value tags for resource filtering",
                "additionalProperties": {
                  "type": "string"
                }
              },
              "resource_types": {
                "type": "array",
                "description": "Specific resource types (EC2, S3, etc.)",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "api_endpoints": {
          "type": "array",
          "description": "API endpoints and services",
          "items": {
            "type": "object",
            "required": ["base_url"],
            "properties": {
              "base_url": {
                "type": "string",
                "format": "uri"
              },
              "version": {
                "type": "string",
                "description": "API version"
              },
              "authentication": {
                "type": "string",
                "enum": ["none", "api_key", "oauth2", "jwt", "basic"],
                "description": "Authentication method"
              },
              "rate_limit": {
                "type": "integer",
                "description": "Requests per minute limit"
              }
            }
          }
        }
      }
    },
    "out_of_scope": {
      "type": "object",
      "description": "Assets explicitly forbidden from testing",
      "properties": {
        "ip_addresses": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "ip_ranges": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["start", "end"],
            "properties": {
              "start": {"type": "string"},
              "end": {"type": "string"},
              "reason": {"type": "string"}
            }
          }
        },
        "hostnames": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "wildcard_domains": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "third_party_services": {
          "type": "array",
          "description": "Third-party services that must not be tested",
          "items": {
            "type": "object",
            "required": ["service_name"],
            "properties": {
              "service_name": {"type": "string"},
              "reason": {"type": "string"}
            }
          }
        }
      }
    },
    "time_windows": {
      "type": "object",
      "description": "Allowed testing time windows",
      "required": ["timezone"],
      "properties": {
        "timezone": {
          "type": "string",
          "description": "IANA timezone identifier (e.g., America/New_York, UTC)"
        },
        "low_impact": {
          "type": "object",
          "description": "Non-destructive testing windows",
          "properties": {
            "days": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"]
              }
            },
            "start_time": {
              "type": "string",
              "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$"
            },
            "end_time": {
              "type": "string",
              "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$"
            }
          }
        },
        "high_impact": {
          "type": "object",
          "description": "Destructive testing windows",
          "properties": {
            "days": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"]
              }
            },
            "start_time": {"type": "string"},
            "end_time": {"type": "string"},
            "approval_required": {
              "type": "boolean",
              "description": "Require explicit approval before each high-impact test"
            }
          }
        },
        "blackout_periods": {
          "type": "array",
          "description": "Periods when no testing is allowed",
          "items": {
            "type": "object",
            "required": ["start", "end"],
            "properties": {
              "start": {
                "type": "string",
                "format": "date-time"
              },
              "end": {
                "type": "string",
                "format": "date-time"
              },
              "reason": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "allowed_methods": {
      "type": "object",
      "description": "Allowed testing methodologies",
      "properties": {
        "passive_reconnaissance": {
          "type": "boolean",
          "default": true
        },
        "network_scanning": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "max_intensity": {
              "type": "string",
              "enum": ["low", "medium", "high"]
            },
            "allowed_ports": {
              "type": "array",
              "items": {"type": "integer"}
            }
          }
        },
        "vulnerability_scanning": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "credentialed": {"type": "boolean"},
            "safe_checks_only": {"type": "boolean"}
          }
        },
        "web_application_testing": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "injection_testing": {"type": "boolean"},
            "authentication_bypass": {"type": "boolean"},
            "authorization_testing": {"type": "boolean"}
          }
        },
        "active_exploitation": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "requires_approval": {"type": "boolean"},
            "isolated_environment_only": {"type": "boolean"}
          }
        },
        "social_engineering": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "phishing": {"type": "boolean"},
            "pretexting": {"type": "boolean"},
            "physical": {"type": "boolean"},
            "requires_hr_approval": {"type": "boolean"}
          }
        },
        "dos_testing": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "isolated_environment_only": {"type": "boolean"}
          }
        }
      }
    },
    "technical_constraints": {
      "type": "object",
      "description": "Technical limitations and thresholds",
      "properties": {
        "rate_limits": {
          "type": "object",
          "properties": {
            "http_requests_per_minute": {"type": "integer"},
            "network_packets_per_second": {"type": "integer"}
          }
        },
        "resource_thresholds": {
          "type": "object",
          "description": "Automatic pause triggers",
          "properties": {
            "cpu_percent": {"type": "integer", "minimum": 0, "maximum": 100},
            "memory_percent": {"type": "integer", "minimum": 0, "maximum": 100},
            "disk_io_percent": {"type": "integer", "minimum": 0, "maximum": 100}
          }
        },
        "data_limits": {
          "type": "object",
          "properties": {
            "max_data_extraction_mb": {"type": "integer"},
            "max_personal_records": {"type": "integer", "default": 0}
          }
        }
      }
    },
    "emergency_contacts": {
      "type": "array",
      "description": "24/7 emergency contacts",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "phone", "email"],
        "properties": {
          "name": {"type": "string"},
          "phone": {"type": "string"},
          "email": {"type": "string", "format": "email"},
          "role": {"type": "string"},
          "priority": {
            "type": "string",
            "enum": ["primary", "secondary", "tertiary"]
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "created_by": {"type": "string"},
        "created_at": {"type": "string", "format": "date-time"},
        "last_modified_by": {"type": "string"},
        "last_modified_at": {"type": "string", "format": "date-time"},
        "notes": {"type": "string"}
      }
    }
  }
}
