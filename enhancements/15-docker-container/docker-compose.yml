version: '3.8'

services:
  ark:
    build:
      context: ../..
      dockerfile: enhancements/15-docker-container/Dockerfile
    image: ark:latest
    container_name: ark-container
    restart: unless-stopped
    
    ports:
      - "8000:8000"    # ARK API
      - "6379:6379"    # Redis (optional, if exposing)
      - "11434:11434"  # Ollama (optional, if exposing)
    
    volumes:
      # Persistent data
      - ark-data:/home/ark/ark/data
      # Configuration
      - ./ark.env:/home/ark/ark/.env:ro
    
    environment:
      - NODE_ENV=production
      - ARK_API_PORT=8000
      - ARK_API_HOST=0.0.0.0
      - ARK_REDIS_HOST=127.0.0.1
      - ARK_REDIS_PORT=6379
      - ARK_OLLAMA_HOST=http://127.0.0.1:11434
      - ARK_OLLAMA_MODEL=llama3.2:1b
      - ARK_DEBUG=false
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
    networks:
      - ark-network

  # Optional: Separate Redis container (if you prefer)
  # redis:
  #   image: redis:7-alpine
  #   container_name: ark-redis
  #   restart: unless-stopped
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - ark-network

  # Optional: Separate Ollama container
  # ollama:
  #   image: ollama/ollama:latest
  #   container_name: ark-ollama
  #   restart: unless-stopped
  #   ports:
  #     - "11434:11434"
  #   volumes:
  #     - ollama-data:/root/.ollama
  #   networks:
  #     - ark-network

volumes:
  ark-data:
    driver: local
  # redis-data:
  #   driver: local
  # ollama-data:
  #   driver: local

networks:
  ark-network:
    driver: bridge
